<form action="#" [formGroup]="researchForm">

    <div class="flex justify-between items-center">

        <div class="flex items-center">
            <nz-page-header class="site-page-header" (nzBack)="onBackInvestigation()" nzBackIcon />
            <app-breadcrumb />

        </div>

        <div class="flex items-center p-5 space-x-7">

            <nz-select formControlName="status" nzPlaceHolder="Seleccione Estado">
                <nz-option nzValue="E" nzLabel="En ejecuci칩n"></nz-option>
                <nz-option nzValue="F" nzLabel="Finalizado"></nz-option>
            </nz-select>

            <button nz-button nzType="primary" nzBlock nzSize="default" (click)="submitNewResearch()"
                class="transition ease-in-out delay-150 bg-blue-500 hover:-translate-y-1 hover:scale-110 hover:bg-indigo-500 duration-300">
                Crear
            </button>

        </div>

    </div>

    <div class="container">


        <div class="flex space-x-6">
            <div class="w-1/4">
                <nz-steps [nzCurrent]="currentStep" nzDirection="vertical" (nzIndexChange)="onIndexChange($event)"
                    nzSize="small">
                    <nz-step nzTitle="Datos Generales" class="font-controlG"></nz-step>
                    <nz-step nzTitle="Presupuestos" class="font-controlG"></nz-step>
                    <nz-step nzTitle="Integrantes" class="font-controlG"></nz-step>
                </nz-steps>
            </div>

            <div class="w-3/4">
                <div *ngIf="currentStep === 0" class="grid grid-cols-2 gap-6">
                    <div>
                        <label for="code" class="block text-sm font-medium leading-6 font-controlG">C칩digo *</label>
                        <div class="relative mt-2 rounded-md shadow-sm max-w-sm">
                            <input type="text" name="code" id="code" formControlName="code"
                                [ngClass]="{ 'ring-red-500': researchForm.controls['code'].invalid && researchForm.controls['code'].touched }"
                                class="font-controlG block w-full rounded-md border-0 py-1.5 pl-3 pr-20 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-50 sm:text-sm sm:leading-6"
                                placeholder="">
                        </div>

                        <div *ngIf="researchForm.controls['code'].invalid && researchForm.controls['code'].touched"
                            class="text-sm text-red-500 mt-1">
                            <span class="font-controlG"
                                *ngIf="researchForm.controls['code'].errors?.['required']">C칩digo es requerido.</span>
                        </div>

                    </div>

                    <div>
                        <label for="name_project" class="block text-sm font-medium leading-6 font-controlG">Nombre
                            *</label>
                        <div class="relative mt-2 rounded-md shadow-sm max-w-sm">
                            <textarea nz-input formControlName="name_project"
                                class="font-controlG block w-full rounded-md border-0 py-1.5 pl-3 pr-20 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-50 sm:text-sm sm:leading-6"
                                [ngClass]="{ 'ring-red-500': researchForm.controls['name_project'].invalid && researchForm.controls['name_project'].touched }"
                                [nzAutosize]="{ minRows: 2, maxRows: 5 }">
                                </textarea>
                        </div>

                        <div *ngIf="researchForm.controls['name_project'].invalid && researchForm.controls['name_project'].touched"
                            class="text-sm text-red-500 mt-1">
                            <span class="font-controlG"
                                *ngIf="researchForm.controls['name_project'].errors?.['required']">Nombre del proyecto
                                es requerido.</span>
                        </div>

                    </div>

                    <div>
                        <label for="rcu" class="block text-sm font-medium leading-6 font-controlG">RCU *</label>
                        <div class="relative mt-2 rounded-md shadow-sm max-w-sm">
                            <input type="text" name="rcu" id="rcu" formControlName="rcu"
                                class="font-controlG block w-full rounded-md border-0 py-1.5 pl-3 pr-20 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-50 sm:text-sm sm:leading-6"
                                placeholder="">
                        </div>

                        <div *ngIf="researchForm.controls['rcu'].invalid && researchForm.controls['rcu'].touched"
                            class="text-sm text-red-500 mt-1">
                            <span class="font-controlG" *ngIf="researchForm.controls['rcu'].errors?.['required']">RCU es
                                requerido.</span>
                        </div>

                    </div>

                    <div>
                        <label for="faculty" class="block text-sm font-medium leading-6 font-controlG">Facultad
                            *</label>
                        <div class="relative mt-2 rounded-md shadow-sm max-w-sm">
                            <textarea nz-input formControlName="faculty"
                                class="font-controlG block w-full rounded-md border-0 py-1.5 pl-3 pr-20 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-50 sm:text-sm sm:leading-6"
                                [ngClass]="{ 'ring-red-500': researchForm.controls['faculty'].invalid && researchForm.controls['faculty'].touched }"
                                [nzAutosize]="{ minRows: 2, maxRows: 5 }">
                                </textarea>
                        </div>

                        <div *ngIf="researchForm.controls['faculty'].invalid && researchForm.controls['faculty'].touched"
                            class="text-sm text-red-500 mt-1">
                            <span class="font-controlG"
                                *ngIf="researchForm.controls['faculty'].errors?.['required']">Facultad es
                                requerido.</span>
                        </div>

                    </div>

                    <div>
                        <label for="duration" class="block text-sm font-medium leading-6 font-controlG">Duraci&oacute;n
                            *</label>
                        <div class="relative mt-2 rounded-md shadow-sm max-w-sm">
                            <input type="text" name="duration" id="duration" formControlName="duration"
                                class="font-controlG block w-full rounded-md border-0 py-1.5 pl-3 pr-20 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-50 sm:text-sm sm:leading-6"
                                placeholder="">
                        </div>

                        <div *ngIf="researchForm.controls['duration'].invalid && researchForm.controls['duration'].touched"
                            class="text-sm text-red-500 mt-1">
                            <span class="font-controlG"
                                *ngIf="researchForm.controls['duration'].errors?.['required']">Duraci&oacute;n es
                                requerido.</span>
                        </div>

                    </div>

                    <div>
                        <label for="impact" class="block text-sm font-medium leading-6 font-controlG">Impacto</label>
                        <div class="relative mt-2 rounded-md shadow-sm max-w-sm">
                            <input type="text" name="impact" id="impact" formControlName="impact"
                                class="font-controlG block w-full rounded-md border-0 py-1.5 pl-3 pr-20 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-50 sm:text-sm sm:leading-6"
                                placeholder="">
                        </div>

                    </div>

                    <div>
                        <label for="dateIni" class="block text-sm font-medium leading-6 font-controlG">Fecha de Inicio
                        </label>
                        <div class="relative mt-2 rounded-md shadow-sm max-w-sm">
                            <nz-date-picker nzPlaceHolder="Seleccione" class="w-full"
                                formControlName="date_ini"></nz-date-picker>
                        </div>
                    </div>

                    <div>
                        <label for="dateEnd" class="block text-sm font-medium leading-6 font-controlG">Fecha de
                            Culminaci&oacute;n
                        </label>
                        <div class="relative mt-2 rounded-md shadow-sm max-w-sm">
                            <nz-date-picker nzPlaceHolder="Seleccione" class="w-full"
                                formControlName="date_end"></nz-date-picker>
                        </div>
                    </div>

                </div>

                <div *ngIf="currentStep === 1" class="space-y-6">

                    <div class="flex flex-row">
                        <button nz-button (click)="addPresupuesto()">Agregar presupuesto</button>
                    </div>

                    <div class="flex flex-row">

                        <nz-table #PresupuestoTable nzSize="small" class="font-controlG">
                            <thead>
                                <tr>
                                    <th nzWidth="250px">A침o de Presupuesto</th>
                                    <th nzWidth="250px">Valor</th>
                                    <th nzWidth="100px"></th>
                                </tr>
                            </thead>
                            <tbody formArrayName="budgets">
                                <tr *ngFor="let item of presupuestoFormArray.controls; let i = index"
                                    [formGroupName]="i">

                                    <td>{{ item.get('date')?.value }}</td>

                                    <td>
                                        <input *ngIf="editId === item.get('id')?.value" type="text"
                                            formControlName="value" class="border border-gray-300 rounded p-1 w-full"
                                            (blur)="saveEdit(item.get('id')?.value)" />
                                        <div *ngIf="editId !== item.get('id')?.value"
                                            (click)="startEdit(item.get('id')?.value)" class="p-1 cursor-pointer">
                                            {{ item.get('value')?.value || 'Click para editar' }}
                                        </div>
                                    </td>

                                    <td>
                                        <button nz-button nzType="link" nzDanger (click)="deletePresupuesto(i)">
                                            Eliminar
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </nz-table>
                    </div>

                </div>

                <div *ngIf="currentStep === 2" class="space-y-6">

                    <div class="flex flex-row">
                        <button nz-button (click)="addIntegrante()">Agregar Integrantes</button>
                    </div>

                    <div class="flex flex-row">

                        <nz-table nzSize="small" class="font-controlG">
                            <thead>
                                <tr>
                                    <th nzWidth="200px">Nombre</th>
                                    <th nzWidth="100px">C&eacute;dula</th>
                                    <th nzWidth="200px">Cargo</th>
                                    <th nzWidth="200px">Email</th>
                                    <th nzWidth="100px"></th>
                                </tr>
                            </thead>
                            <tbody formArrayName="members">
                                <tr *ngFor="let item of memberFormArray.controls; let i = index" [formGroupName]="i">

                                    <td>
                                        <input *ngIf="editIdMember === item.get('id')?.value" 
                                            type="text"
                                            formControlName="name" 
                                            class="border border-gray-300 rounded p-1 w-full"
                                            (blur)="saveEditMember(item.get('id')?.value)" />
                                        <div *ngIf="editIdMember !== item.get('id')?.value"
                                            (click)="startEditMember(item.get('id')?.value)" 
                                            class="p-1 cursor-pointer">
                                            {{ item.get('name')?.value || 'agregar...' }}
                                        </div>
                                    </td>

                                    <td>
                                        <input *ngIf="editIdMember === item.get('id')?.value" 
                                            type="text"
                                            formControlName="dni" 
                                            class="border border-gray-300 rounded p-1 w-full"
                                            (blur)="saveEditMember(item.get('id')?.value)" />
                                        <div *ngIf="editIdMember !== item.get('id')?.value"
                                            (click)="startEditMember(item.get('id')?.value)" 
                                            class="p-1 cursor-pointer">
                                            {{ item.get('dni')?.value || 'agregar...' }}
                                        </div>
                                    </td>

                                    <td>
                                        <input *ngIf="editIdMember === item.get('id')?.value" 
                                            type="text"
                                            formControlName="departament" 
                                            class="border border-gray-300 rounded p-1 w-full"
                                            (blur)="saveEditMember(item.get('id')?.value)" />
                                        <div *ngIf="editIdMember !== item.get('id')?.value"
                                            (click)="startEditMember(item.get('id')?.value)" 
                                            class="p-1 cursor-pointer">
                                            {{ item.get('departament')?.value || 'agregar...' }}
                                        </div>
                                    </td>

                                    <td>
                                        <input *ngIf="editIdMember === item.get('id')?.value" 
                                            type="email"
                                            formControlName="email" 
                                            class="border border-gray-300 rounded p-1 w-full"
                                            (blur)="saveEditMember(item.get('id')?.value)" />
                                        <div *ngIf="editIdMember !== item.get('id')?.value"
                                            (click)="startEditMember(item.get('id')?.value)" 
                                            class="p-1 cursor-pointer">
                                            {{ item.get('email')?.value || 'agregar...' }}
                                        </div>
                                    </td>

                                    <td>
                                        <button nz-button nzType="link" nzDanger (click)="deleteMember(i)">
                                            Eliminar
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </nz-table>
                    </div>

                </div>
            </div>
        </div>

    </div>
</form>